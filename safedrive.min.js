/*
 * The MIT License (MIT)
 * 
 * Copyright (c) 2015 Adam Skobodziński, adam@skobo.pl
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of
 * this software and associated documentation files (the "Software"), to deal in
 * the Software without restriction, including without limitation the rights to
 * use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
 * the Software, and to permit persons to whom the Software is furnished to do so,
 * subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
 * FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
 * COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
 * IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
 * CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */function Situation03(){}function Situation04(){}function Situation02(){}function Situation05(){}function Situation01(){}function SituationsManager(t,i,s,n){this.game=t,this.roadObjectsFactory=i,this.backgroundManipulator=s,this.fx=n,this.situations=[],this.situationsPointer=-1,this.initNotificationsFactoryManager(),this.notificationsFactory=this.notificationsFactoryManager.createFactory(void 0,void 0,!0),this.introNotificationsFactory=this.notificationsFactoryManager.createFactory(void 0,void 0);var o=5;this.buttonMenu=this.game.add.button(565-o,0+o,"reload",function(){this.backToMenu()},this,1,0,2,0),this.buttonMenu.scale.setTo(.75,.75),this.buttonMenu.setSounds(n,"click3",n,"click1"),this.initSituations(),this.buttonMenu.visible=!1}function SituationStage(t,i,s){this.number={},this.manager=t,this.game=i,this.roadObjectsFactory=s,this.startingPositions={},this.stageNumberFromWhichPositionsAreTaken=-1,this.startingPositionsInitialized=!1,this.startingVelocities={},this.startingAnimations={},this.startingNotificationsToPlay={},this.collisionHandlers={},this.notificationsFactory=t.notificationsFactory,this.spritesBodyMovementUnlockNeeded=!1}function Situation(t,i,s,n,o,a){this.game=t,this.roadObjectsFactory=i,this.manager=n,this.notificationsFactoryManager=s,this.concreteSituation=o,this.presenterSprite=a,this.concreteSituation.roadObjectsFactory=this.roadObjectsFactory,this.situationInProgress=!1,this.checkedCollisions={},this.initSituationObjects(),this.notificationsFactory=this.notificationsFactoryManager.createFactory(this.concreteSituation.instructionTexts,this.presenterSprite),this.situationStagesManager=new SituationStagesManager(this.game,this),this.initStages(),this.initIntroduction()}function SituationStagesManager(t,i){this.game=t,this.situation=i,this.stages=[],this.stagesButtonsBad=[],this.stagesButtonsGood=[],this.currentStageNumber=0,this.notificationsFactory=i.notificationsFactory}function onButtonStageClick(){console.log(this.number)}function startSafeDrive(){function t(){c.load.image("car01","assets/car01.png"),c.load.image("car02","assets/car02.png"),c.load.image("bus","assets/bus.png"),c.load.image("scenebig","assets/scene_big.png"),c.load.image("trigger","assets/trigger.png"),c.load.image("trigger_big","assets/trigger_big.png"),c.load.image("presenter","assets/presenter.png"),c.load.image("pedestrian01","assets/pedestrian01.png"),c.load.image("pedestrian02","assets/pedestrian02.png"),c.load.image("pedestrian03","assets/pedestrian03.png"),c.load.spritesheet("bike","assets/bike.png",85,43),c.load.image("ball","assets/shinyball.png"),c.load.image("attention","assets/attention.png"),c.load.image("blank_red","assets/blank_red.png"),c.load.spritesheet("reload","assets/buttons/reload.png",100,100),c.load.spritesheet("button_pl","assets/buttons/pl.png",100,100),c.load.spritesheet("button_en","assets/buttons/en.png",100,100),c.load.spritesheet("button","assets/buttons/button_orange.png",100,100),c.load.image("button_border_normal","assets/buttons/orange_normal_border.png"),c.load.image("button_border_pressed","assets/buttons/orange_pressed_border.png"),c.load.spritesheet("stageButtons","assets/button-round.png",64,64),c.load.audio("sfx","assets/fx/fx_mixdown.mp3")}function i(){r=c.add.audio("sfx"),r.allowMultiple=!0,r.addMarker("click1",1.1,.25),r.addMarker("click2",2,.25),r.addMarker("click3",3,.25),e=new BackgroundManipulator(c),o=new RoadObjectFactory(c),a=new SituationsManager(c,o,e,r)}function s(){o.callAll(RoadObject.prototype.updateText),a.update()}function n(){o.roadObjectsGroup.forEach(function(t){sConstants.DEBUG&&c.debug.body(t)})}var o,a,e,r,c=new Phaser.Game(640,480,Phaser.CANVAS,"game",{preload:t,create:i,update:s,render:n})}function Notification(t,i,s,n,o,a,e,r,c,_,h){this.factory=t,this.game=i,this.fx=r,this.callback=c,this.callbackContext=_,this.callArgs=h,this.id=s,this.tweenFunction=Phaser.Easing.Linear.None,this.requestedX=a,this.requestedY=e,this.languageTextArrays=n,this.languageTextObjects={pl:[],en:[]},this.initEmptyLanguages(),this.presenterSprite=o,this.margins=15,this.fx=r,this.initButton(),this.initTextObjects(this.languageTextArrays.pl,this.languageTextObjects.pl),this.initTextObjects(this.languageTextArrays.en,this.languageTextObjects.en)}function NotificationsFactory(t,i,s,n,o){this.game=t,this.notifications={},this.instructionTexts=i,this.presenterSprite=s,this.fx=n,this.sameWidth=o,this.language=constantsLanguages.PL,this.initAttentionManager()}function AttentionManager(t){this.game=t,this.sprite=this.game.add.sprite(30,30,"attention"),this.sprite.anchor.setTo(.5,.5),this.sprite.width=75,this.sprite.height=75,this.tweenFunction=Phaser.Easing.Linear.None,this.tweenSpeed=500,this.tween=this.game.add.tween(this.sprite).to({width:50},this.tweenSpeed,this.tweenFunction,!0,0,-1,!0),this.tween=this.game.add.tween(this.sprite).to({height:50},this.tweenSpeed,this.tweenFunction,!0,0,-1,!0),this.sprite.visible=!1}function NotificationsFactoryManager(t,i){this.game=t,this.fx=i,this.factories=[],this.languagesManager=new LanguagesManager(this.game,this,this.fx)}function LanguagesManager(t,i,s){this.game=t,this.notificationsFactoryManager=i,this.fx=s,this.buttonPL=this.game.add.button(0,0,"button_pl",LanguagesManager.prototype.buttonClickedPL,this,1,0,2,0),this.buttonEN=this.game.add.button(0,0,"button_en",LanguagesManager.prototype.buttonClickedEN,this,1,0,2,0);var n=.5,o=10,a=this.buttonPL.width,e=o+a*n/2;this.buttonPL.position.setTo(a*n/2+o,e),this.buttonEN.position.setTo(a*n/2+a*n+2*o,e),this.buttonPL.setSounds(this.fx,"click3",this.fx,"click1"),this.buttonEN.setSounds(this.fx,"click3",this.fx,"click1"),this.buttonPL.anchor.setTo(.5,.5),this.buttonEN.anchor.setTo(.5,.5),this.buttonPL.scale.setTo(n,n),this.buttonEN.scale.setTo(n,n)}constantsLanguages={PL:"pl",EN:"en"},sConstants={DEBUG:!1,DEBUG_SITUATION:3,PRESENTER_VISIBLE:!1,SITUATION_START_WITH_INTRODUCTION:!1,OBJECT_PEDESTRIAN:"PEDESTRIAN",OBJECT_PEDESTRIAN_2:"PEDESTRIAN_2",OBJECT_PEDESTRIAN_3:"PEDESTRIAN_3",OBJECT_CAR_A:"CAR_A",OBJECT_CAR_B:"CAR_B",OBJECT_BIKE:"BIKE",OBJECT_BUS:"OBJECT_BUS",OBJECT_ROTATION_P:"OBJECT_ROTATION_P",TRIGGER_S01_PEDESTRIAN:"T_01_PEDEDESTRIAN",TRIGGER_S01_END:"T_01_END",TRIGGER_S02_CARA_BRAKE:"TRIGGER_S02_CARA_BRAKE",TRIGGER_S02_CARA_STOP:"TRIGGER_S02_CARA_STOP",TRIGGER_S03_CARB_BRAKE:"TRIGGER_S03_CARB_BRAKE",TRIGGER_S07_PEDESTRIAN_CHECK:"TRIGGER_S07_PEDESTRIAN_CHECK",TRIGGER_S07_CARB_BRAKE:"TRIGGER_S07_CARB_BRAKE",TRIGGER_S07_CARB_STOP:"TRIGGER_S07_CARB_STOP",TRIGGER_S08_PEDESTRIAN_FINISH:"TRIGGER_S08_PEDESTRIAN_FINISH",NOTIF_S01_PEDESTRIAN:"N_S01_PEDESTRIAN",NOTIF_S02_CARA_START:"NOTIF_S01_CARA_START",NOTIF_S02_CARA_BRAKE:"NOTIF_S02_CARA_BRAKE",NOTIF_S02_PEDESTRIAN_CONTINUE:"NOTIF_02_PEDESTRIAN_CONTINUE",NOTIF_S03_CARB_START:"NOTIF_S03_CARB_START",NOTIF_S03_CARB_BRAKE:"NOTIF_S03_CARB_BRAKE",NOTIF_S04_COLLISION:"NOTIF_S04_COLLISION",NOTIF_S07_PEDESTRIAN_CHECK:"NOTIF_S07_PEDESTRIAN_CHECK",NOTIF_S07_CARB_BRAKE:"NOTIF_S07_CARB_BRAKE",NOTIF_S08_PEDESTRIAN_CONTINUE:"NOTIF_S08_PEDESTRIAN_CONTINUE",T02_01_CAR_INTRO:"T02_01_CAR_INTRO",T02_02_CAR_TURN:"T02_01_CAR_TURN",N02_01_CAR_TURN:"N02_01_CAR_TURN",N02_02_BIKE_INTRO:"N02_02_BIKE_INTRO",N02_03_CAR_A_CONTIMUE:"N02_03_CAR_A_CONTIMUE",N02_04_COLLISION:"N02_04_COLLISION",N02_06_CAR_A_CONTINUE:"N02_06_CAR_A_CONTINUE",N02_07_WAIT:"N02_07_WAIT",T03_01_CAR_INTRO:"T03_01_CAR_INTRO",T03_02_CAR_TURN:"T03_02_CAR_TURN",T03_06_BIKE_STOP:"T03_06_BIKE_STOP",T03_08_CAR_CONTINUE:"T03_08_CAR_CONTINUE",N03_01_CAR_INTRO:"N03_01_CAR_INTRO",N03_02_BIKE_INTRO:"N03_02_BIKE_INTRO",N03_03_CAR_CONTINUE:"N03_02_CAR_CONTINUE",N03_03_BIKE_CONTINUE:"N03_03_BIKE_CONTINUE",N03_04_COLLISION:"N03_04_COLLISION",N03_04_COLLISION:"N03_04_COLLISION",N03_06_BIKE_SLOW:"N03_06_BIKE_SLOW",N03_06_CAR_SLOW:"N03_06_CAR_SLOW",N03_06_BIKE_WALK:"N03_06_BIKE_WALK",N04_01_INTRO:"N04_01_INTRO",N04_02_OVERTAKE_INTRO:"N04_02_OVERTAKE_INTRO",N04_03_OVERTAKE_PEDESTRIAN:"N04_03_OVERTAKE_PEDESTRIAN",N04_04_ILLEGAL:"N04_04_ILLEGAL",N04_05_OVERTAKE_INTRODUCTION:"N04_05_OVERTAKE_INTRODUCTION",N04_07_FINISH:"N04_07_FINISH",T04_02_OVERTAKE_INTRO:"T04_02_OVERTAKE_INTRO",T04_03_OVERTAKE_PEDESTRIAN:"T04_03_OVERTAKE_PEDESTRIAN",T04_04_BAD_END:"T04_04_BAD_END",T05_01_BUS_SLOW:"T04_01_BUS_SLOW",T05_01_BUS_STOP:"T05_01_BUS_STOP",T05_02_PED_TURN:"T05_02_PED_TURN",T05_02_PED_TURN_BUS:"T05_02_PED_TURN_BUS",T05_03_PED_CONTINUE:"T05_03_PED_CONTINUE",T05_07_PED_CONTINUE_PROPER:"T05_07_PED_CONTINUE_PROPER",T05_08_CAR_STOP:"T05_08_CAR_STOP",T05_08_CAR_CONTINUE:"T05_08_CAR_CONTINUE",N05_02_BUS_OUT:"N05_02_BUS_OUT",N05_03_PED_TURN:"N05_03_PED_TURN",N05_03_PED_CONTINUE:"N05_03_PED_CONTINUE",N05_04_COLLISION:"N05_04_COLLISION",N05_07_PEDESTRIAN_PROPER:"N05_07_PEDESTRIAN_PROPER",N05_08_FINISH:"N05_08_FINISH"},Situation03.prototype.sector={x:0,y:0},Situation03.prototype.title={pl:["Rowerzysta na","przejściu dla pieszych."],en:["A cyclist on a","pedestrian crossing."]},Situation03.prototype.collisions=[[sConstants.T03_01_CAR_INTRO,sConstants.OBJECT_CAR_A],[sConstants.T03_02_CAR_TURN,sConstants.OBJECT_CAR_A],[sConstants.OBJECT_CAR_A,sConstants.OBJECT_BIKE],[sConstants.T03_06_BIKE_STOP,sConstants.OBJECT_BIKE],[sConstants.T03_08_CAR_CONTINUE,sConstants.OBJECT_BIKE]],Situation03.prototype.situationPlan=[{type:"roadObject",sprite:"bike",name:sConstants.OBJECT_BIKE,posX:465,posY:600,angle:90},{type:"roadObject",sprite:"car01",name:sConstants.OBJECT_CAR_A,posX:250,posY:900,angle:-90},{type:"roadObject",sprite:"ball",name:sConstants.OBJECT_ROTATION_P,posX:350,posY:226,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T03_01_CAR_INTRO,posX:250,posY:350,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T03_02_CAR_TURN,posX:250,posY:210,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T03_06_BIKE_STOP,posX:460,posY:160,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T03_08_CAR_CONTINUE,posX:460,posY:20,angle:0}],Situation03.prototype.instructionTexts={bad:{name:"situationIntroducion",text:{pl:["Opis sytuacji.","Opis sytuacji.","Opis sytuacji."],en:[]}},good:{name:"goodIntroduction",text:{pl:["Z braku rozwagi dochodzi do tragedii.","Jak powinna wyglądać prawidłowa","sytuacja?"],en:[]}}},Situation04.prototype.sector={x:1,y:2},Situation04.prototype.title={pl:["Wyprzedzanie na","przejściu dla pieszych."],en:["An overtake at a","pedestrian crossing."]},Situation04.prototype.collisions=[[sConstants.T04_02_OVERTAKE_INTRO,sConstants.OBJECT_CAR_B],[sConstants.T04_03_OVERTAKE_PEDESTRIAN,sConstants.OBJECT_CAR_B],[sConstants.T04_04_BAD_END,sConstants.OBJECT_CAR_B]],Situation04.prototype.situationPlan=[{type:"roadObject",sprite:"car01",name:sConstants.OBJECT_CAR_A,posX:530,posY:800,angle:-90},{type:"roadObject",sprite:"car02",name:sConstants.OBJECT_CAR_B,posX:468,posY:800,angle:-90},{type:"roadTrigger",sprite:"trigger",name:sConstants.T04_02_OVERTAKE_INTRO,posX:465,posY:280,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T04_03_OVERTAKE_PEDESTRIAN,posX:465,posY:135,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T04_04_BAD_END,posX:465,posY:60,angle:0}],Situation04.prototype.instructionTexts={bad:{name:"situationIntroducion",text:{pl:["Opis sytuacji.","Opis sytuacji.","Opis sytuacji."],en:[]}},good:{name:"goodIntroduction",text:{pl:["Jak powinna wyglądać prawidłowa","sytuacja?"],en:[]}}},Situation01.prototype.initStage=function(t,i){var s=1,n=-27*s,o=-200*s,a=-450*s;switch(t){case 0:i.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN,n,0);var e=i.notification().addNotification(sConstants.NOTIF_S01_PEDESTRIAN,{pl:["Pieszy zbliża się","do przejścia."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,n,0)},i);e.addPressMeNotification(),i.addCollisionHandler(sConstants.TRIGGER_S01_PEDESTRIAN,sConstants.OBJECT_PEDESTRIAN,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(0,0),this.notification().startNotification(sConstants.NOTIF_S01_PEDESTRIAN)}),i.addCollisionHandler(sConstants.TRIGGER_S01_END,sConstants.OBJECT_PEDESTRIAN,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(0,0),this.addEvent(0,this.setFinished)});break;case 1:i.notification().addNotification(sConstants.NOTIF_S02_CARA_START,{pl:["Nadjeżdża samochód."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,0,0),this.addEventVelocity(0,sConstants.OBJECT_CAR_A,0,o)},i),i.addStartingNotificationPlay(sConstants.NOTIF_S02_CARA_START),i.addCollisionHandler(sConstants.TRIGGER_S02_CARA_BRAKE,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().startNotification(sConstants.NOTIF_S02_CARA_BRAKE)}),i.notification().addNotification(sConstants.NOTIF_S02_CARA_BRAKE,{pl:["Kierowca widząc pieszego,","rozpoczyna hamowanie."],en:[]},1,1,function(){this.notification().startNotification(sConstants.NOTIF_S02_PEDESTRIAN_CONTINUE)},i),i.notification().addNotification(sConstants.NOTIF_S02_PEDESTRIAN_CONTINUE,{pl:["Pieszy widząc,","że kierowca ma zamiar się zatrzymać,","przechodzi przez przejście."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,n,0),this.addEventVelocity(0,sConstants.OBJECT_CAR_A,0,.75*o,0,40*s)},i),i.addCollisionHandler(sConstants.TRIGGER_S02_CARA_STOP,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.addEvent(0,this.setFinished)});break;case 2:i.notification().addNotification(sConstants.NOTIF_S03_CARB_START,{pl:["Tymczasem nadjeżdża drugi kierowca,","który nie zwalnia przed przejściem."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,n,0),this.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,a)},i),i.notification().addNotification(sConstants.NOTIF_S03_CARB_BRAKE,{pl:["Kierowca widząc pieszego,","nie ma już czasu na hamowanie."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i),i.addStartingNotificationPlay(sConstants.NOTIF_S03_CARB_START),i.addCollisionHandler(sConstants.TRIGGER_S03_CARB_BRAKE,sConstants.OBJECT_CAR_B,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_B).setVelocity(0,0),this.notification().startNotification(sConstants.NOTIF_S03_CARB_BRAKE)}),i.addCollisionHandler(sConstants.OBJECT_CAR_B,sConstants.OBJECT_PEDESTRIAN,function(){this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,0,0),this.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,0)});break;case 3:i.addStartingVelocity(sConstants.OBJECT_CAR_B,0,.75*a,0,300),i.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN,n,0),i.notification().addNotification(sConstants.NOTIF_S04_COLLISION,{pl:["Dochodzi do potrącania."],en:[]},1,1,function(){this.notification().startNotification(Situation01.prototype.instructionTexts.good.name)},i),i.addCollisionHandler(sConstants.OBJECT_CAR_B,sConstants.OBJECT_PEDESTRIAN,function(){this.getObject(sConstants.OBJECT_CAR_B).setVelocity(0,0),this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(0,0),this.notification().startNotification(sConstants.NOTIF_S04_COLLISION),this.notification().attentionShow(this.getObject(sConstants.OBJECT_PEDESTRIAN).sprite.position)});break;case 4:i.stageNumberFromWhichPositionsAreTaken=0,this.initStage(0,i);break;case 5:this.initStage(1,i);break;case 6:i.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN,n,0),i.notification().addNotification(sConstants.NOTIF_S07_PEDESTRIAN_CHECK,{pl:["Pieszy wie, że z drugiego pasa może","wyjechać łamiący przepisy kierowca,","dlatego zapobiegliwie sprawdza,","czy może iść dalej."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,a),this.getObject(sConstants.OBJECT_PEDESTRIAN).sprite.angle=-45},i),i.addCollisionHandler(sConstants.TRIGGER_S07_PEDESTRIAN_CHECK,sConstants.OBJECT_PEDESTRIAN,function(){this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,0,0),this.notification().startNotification(sConstants.NOTIF_S07_PEDESTRIAN_CHECK)}),i.notification().addNotification(sConstants.NOTIF_S07_CARB_BRAKE,{pl:["Zbliżający się kierowca, widząc samochod,","który zatrzymał się przed przejściem,","również zatrzymuje się przed przejściem","dla pieszych."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,o,0,70)},i),i.addCollisionHandler(sConstants.TRIGGER_S07_CARB_BRAKE,sConstants.OBJECT_CAR_B,function(){this.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,0),this.notification().startNotification(sConstants.NOTIF_S07_CARB_BRAKE)}),i.addCollisionHandler(sConstants.TRIGGER_S07_CARB_STOP,sConstants.OBJECT_CAR_B,function(){this.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,0),this.addEvent(0,this.setFinished)});break;case 7:i.notification().addNotification(sConstants.NOTIF_S08_PEDESTRIAN_CONTINUE,{pl:["Pieszy widząc, że jest bezpieczny,","kontynuuje przejście."],en:[]},1,1,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).sprite.angle=0,this.addEventVelocity(0,sConstants.OBJECT_PEDESTRIAN,n,0),this.addEventVelocity(4,sConstants.OBJECT_CAR_A,0,.3*o,0,-100),this.addEventVelocity(4,sConstants.OBJECT_CAR_B,0,.3*o,0,-200)},i),i.addStartingNotificationPlay(sConstants.NOTIF_S08_PEDESTRIAN_CONTINUE),i.addCollisionHandler(sConstants.TRIGGER_S08_PEDESTRIAN_FINISH,sConstants.OBJECT_PEDESTRIAN,function(){this.addEvent(0,this.setFinished)});break;default:console.log("initStage() unknown stageNumber")}},Situation02.prototype.sector={x:1,y:1},Situation02.prototype.title={pl:["Przejeżdżanie przez","ścieżkę rowerową."],en:["Cars and a bike","lane."]},Situation02.prototype.collisions=[[sConstants.T02_01_CAR_INTRO,sConstants.OBJECT_CAR_A],[sConstants.T02_02_CAR_TURN,sConstants.OBJECT_CAR_A],[sConstants.OBJECT_CAR_A,sConstants.OBJECT_BIKE]],Situation02.prototype.situationPlan=[{type:"roadObject",sprite:"bike",name:sConstants.OBJECT_BIKE,posX:125,posY:-80,angle:90},{type:"roadObject",sprite:"car01",name:sConstants.OBJECT_CAR_A,posX:350,posY:-500,angle:90},{type:"roadTrigger",sprite:"trigger",name:sConstants.T02_01_CAR_INTRO,posX:350,posY:100,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T02_02_CAR_TURN,posX:350,posY:190,angle:0},{type:"roadObject",sprite:"ball",name:sConstants.OBJECT_ROTATION_P,posX:244,posY:170,angle:0}],Situation02.prototype.instructionTexts={bad:{name:"situationIntroducion",text:{pl:["Opis sytuacji.","Opis sytuacji.","Opis sytuacji."],en:[]}},good:{name:"goodIntroduction",text:{pl:["Z braku rozwagi dochodzi do tragedii.","Jak powinna wyglądać prawidłowa","sytuacja?"],en:[]}}},Situation03.prototype.initStage=function(t,i){var s=250,n=200;switch(t){case 0:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,-n);var o=i.notification().addNotification(sConstants.N03_01_CAR_INTRO,{pl:["Kierowca zbliża się do skrzyżowania","z zamiarem skrętu w prawo."],en:[]},1,1,function(){this.addEvent(0,this.setFinished),this.getObject(sConstants.OBJECT_BIKE).sprite.animations.play("ride")},i);o.addPressMeNotification(),i.addCollisionHandler(sConstants.T03_01_CAR_INTRO,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().startNotification(sConstants.N03_01_CAR_INTRO)});break;case 1:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,-n),i.addStartingVelocity(sConstants.OBJECT_BIKE,0,-s),i.notification().addNotification(sConstants.N03_02_BIKE_INTRO,{pl:["Tymczasem","chodnikiem jedzie rowerzysta."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i),i.addCollisionHandler(sConstants.T03_02_CAR_TURN,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.getObject(sConstants.OBJECT_BIKE).setVelocity(0,0),this.notification().startNotification(sConstants.N03_02_BIKE_INTRO)});break;case 2:i.addStartingNotificationPlay(sConstants.N03_02_CAR_CONTINUE),i.notification().addNotification(sConstants.N03_02_CAR_CONTINUE,{pl:["Nie widząc pieszych na przejściu,","kierowca wykonuje manewr skrętu w","prawo."],en:[]},1,1,function(){this.notification().startNotification(sConstants.N03_03_BIKE_CONTINUE)},i),i.notification().addNotification(sConstants.N03_03_BIKE_CONTINUE,{pl:["Rowerzysta niezgodnie z przepisami","kontynuuje przejazd po","przejściu dla pieszych."],en:[]},1,1,function(){i.addEventVelocity(0,sConstants.OBJECT_BIKE,0,-s),i.addEventStartTurn(0,sConstants.OBJECT_CAR_A,sConstants.OBJECT_ROTATION_P,0,800,function(){this.setFinished()},i)},i);break;case 3:i.addStartingVelocity(sConstants.OBJECT_BIKE,0,-s),i.addStartingVelocity(sConstants.OBJECT_CAR_A,n,0,-100,0),i.addCollisionHandler(sConstants.OBJECT_CAR_A,sConstants.OBJECT_BIKE,function(){this.getObject(sConstants.OBJECT_BIKE).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().attentionShow(this.getObject(sConstants.OBJECT_BIKE).sprite.position),this.notification().startNotification(sConstants.N03_04_COLLISION)}),i.notification().addNotification(sConstants.N03_04_COLLISION,{pl:["Kierowca spodziewając się","w tym miejscu jedynie pieszych,","zderza się z rozpędzonym rowerem."],en:[]},1,1,function(){this.notification().startNotification(Situation03.prototype.instructionTexts.good.name)},i);break;case 4:i.stageNumberFromWhichPositionsAreTaken=0,this.initStage(0,i);break;case 5:this.initStage(1,i);break;case 6:i.addStartingNotificationPlay(sConstants.N03_06_BIKE_SLOW),i.notification().addNotification(sConstants.N03_06_BIKE_SLOW,{pl:["Widząc przejście,","rowerzysta zwalnia."],en:[]},1,1,function(){this.notification().startNotification(sConstants.N03_06_CAR_SLOW)},i),i.notification().addNotification(sConstants.N03_06_CAR_SLOW,{pl:["Kierowca równiez zmniejsza prędkość,","widząc, że zbliża się","do przejścia dla pieszych."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_BIKE,0,-s,0,80),this.addEventStartTurn(0,sConstants.OBJECT_CAR_A,sConstants.OBJECT_ROTATION_P,0,2e3,function(){},i)},i),i.notification().addNotification(sConstants.N03_06_BIKE_WALK,{pl:["Rowerzysta, aby przejśc przez przejście,","zsiada z roweru. Kierowca widzi wyraźnie,","że rowerzysta będzie przeprowadzał rower."],en:[]},1,1,function(){this.setFinished()},i),i.addCollisionHandler(sConstants.T03_06_BIKE_STOP,sConstants.OBJECT_BIKE,function(){this.getObject(sConstants.OBJECT_BIKE).setVelocity(0,0),this.getObject(sConstants.OBJECT_BIKE).sprite.animations.play("walk"),this.notification().startNotification(sConstants.N03_06_BIKE_WALK)});break;case 7:i.addStartingVelocity(sConstants.OBJECT_BIKE,0,-s/3),i.addCollisionHandler(sConstants.T03_08_CAR_CONTINUE,sConstants.OBJECT_BIKE,function(){this.addEventVelocity(0,sConstants.OBJECT_CAR_A,n/8,0,300,0),this.addEvent(1.5,this.setFinished)});break;default:console.log("initStage() unknown stageNumber")}},Situation05.prototype.sector={x:2,y:0},Situation05.prototype.title={pl:["Autobus i","wychodzący pasażerowie."],en:["A bus and its","passengers."]},Situation05.prototype.collisions=[[sConstants.T05_01_BUS_SLOW,sConstants.OBJECT_BUS],[sConstants.T05_01_BUS_STOP,sConstants.OBJECT_BUS],[sConstants.T05_02_PED_TURN,sConstants.OBJECT_PEDESTRIAN],[sConstants.T05_02_PED_TURN,sConstants.OBJECT_PEDESTRIAN_2],[sConstants.T05_02_PED_TURN,sConstants.OBJECT_PEDESTRIAN_3],[sConstants.T05_02_PED_TURN_BUS,sConstants.OBJECT_PEDESTRIAN_3],[sConstants.T05_03_PED_CONTINUE,sConstants.OBJECT_PEDESTRIAN_3],[sConstants.OBJECT_PEDESTRIAN_3,sConstants.OBJECT_CAR_A],[sConstants.T05_07_PED_CONTINUE_PROPER,sConstants.OBJECT_PEDESTRIAN_3],[sConstants.T05_02_PED_TURN_BUS,sConstants.OBJECT_PEDESTRIAN_2],[sConstants.T05_08_CAR_STOP,sConstants.OBJECT_CAR_A],[sConstants.T05_08_CAR_CONTINUE,sConstants.OBJECT_PEDESTRIAN_3]],Situation05.prototype.situationPlan=[{type:"roadObject",sprite:"pedestrian01",name:sConstants.OBJECT_PEDESTRIAN,posX:352,posY:-200,angle:0},{type:"roadObject",sprite:"pedestrian02",name:sConstants.OBJECT_PEDESTRIAN_2,posX:352,posY:-240,angle:0},{type:"roadObject",sprite:"pedestrian03",name:sConstants.OBJECT_PEDESTRIAN_3,posX:352,posY:-277,angle:0},{type:"roadObject",sprite:"bus",name:sConstants.OBJECT_BUS,posX:352,posY:-250,angle:90},{type:"roadObject",sprite:"car01",name:sConstants.OBJECT_CAR_A,posX:410,posY:600,angle:-90},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_01_BUS_SLOW,posX:350,posY:250,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_01_BUS_STOP,posX:350,posY:480,angle:0},{type:"roadTrigger",sprite:"trigger_big",name:sConstants.T05_02_PED_TURN,posX:276,posY:410,angle:90},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_02_PED_TURN_BUS,posX:300,posY:292,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_03_PED_CONTINUE,posX:362,posY:305,angle:90},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_07_PED_CONTINUE_PROPER,posX:300,posY:100,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_08_CAR_STOP,posX:410,posY:145,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.T05_08_CAR_CONTINUE,posX:480,posY:100,angle:90}],Situation05.prototype.instructionTexts={bad:{name:"situationIntroducion",text:{pl:["Opis sytuacji.","Opis sytuacji.","Opis sytuacji."],en:[]}},good:{name:"goodIntroduction",text:{pl:["Z braku rozwagi dochodzi do tragedii.","Jak powinna wyglądać prawidłowa","sytuacja?"],en:[]}}},Situation05.prototype.initStage=function(t,s){function n(t,n,o,a){for(i=0;i<r.length;i++)s.getObject(r[i]).setVelocity(t,n,o,a)}var o=150,a=50,e=300,r=[sConstants.OBJECT_PEDESTRIAN,sConstants.OBJECT_PEDESTRIAN_2,sConstants.OBJECT_PEDESTRIAN_3];switch(t){case 0:s.addStartingVelocity(sConstants.OBJECT_BUS,0,o),s.addStartingVelocity(r,0,o),s.addCollisionHandler(sConstants.T05_01_BUS_SLOW,sConstants.OBJECT_BUS,function(){this.getObject(sConstants.OBJECT_BUS).setVelocity(0,o,0,-48),n(0,o,0,-48)}),s.addCollisionHandler(sConstants.T05_01_BUS_STOP,sConstants.OBJECT_BUS,function(){this.getObject(sConstants.OBJECT_BUS).setVelocity(0,0),n(0,0),this.setFinished()});break;case 1:s.addStartingNotificationPlay(sConstants.N05_02_BUS_OUT);var c=s.notification().addNotification(sConstants.N05_02_BUS_OUT,{pl:["Pasażerowie opuszczają","autobus."],en:[]},1,1,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(-a,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(-a,0)},s);c.addPressMeNotification(),s.addCollisionHandler(sConstants.T05_02_PED_TURN,sConstants.OBJECT_PEDESTRIAN,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN).setVelocity(0,a),this.getObject(sConstants.OBJECT_PEDESTRIAN).sprite.angle=-90}),s.addCollisionHandler(sConstants.T05_02_PED_TURN,sConstants.OBJECT_PEDESTRIAN_2,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,-a),this.getObject(sConstants.OBJECT_PEDESTRIAN_2).sprite.angle=90}),s.addCollisionHandler(sConstants.T05_02_PED_TURN,sConstants.OBJECT_PEDESTRIAN_3,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(0,-a),this.getObject(sConstants.OBJECT_PEDESTRIAN_3).sprite.angle=90,this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(-a,0)}),s.addCollisionHandler(sConstants.T05_02_PED_TURN_BUS,sConstants.OBJECT_PEDESTRIAN_3,function(){this.setFinished()});break;case 2:s.addStartingNotificationPlay(sConstants.N05_03_PED_TURN),s.notification().addNotification(sConstants.N05_03_PED_TURN,{pl:["Jednemu z nich wyjątkowo się","spieszy i chcąc przejść na drugą","stronę ulicy, postanawia pójść","najkrótszą, niekoniecznie bezpieczną","drogą."],en:[]},1,1,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).sprite.angle=180,this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(a,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,-a)},s),s.addCollisionHandler(sConstants.T05_03_PED_CONTINUE,sConstants.OBJECT_PEDESTRIAN_3,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(0,0),this.notification().startNotification(sConstants.N05_03_PED_CONTINUE)}),s.notification().addNotification(sConstants.N05_03_PED_CONTINUE,{pl:["Być może zamyślony, nie bierze pod","uwagę, że zza autobusu może","wyjechać pojazd."],en:[]},1,1,function(){this.setFinished()},s);break;case 3:s.addStartingVelocity(sConstants.OBJECT_BUS,0,o/15,0,50),s.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN_3,a,0),s.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN_2,0,-a),s.addStartingVelocity(sConstants.OBJECT_CAR_A,0,-e),s.addCollisionHandler(sConstants.OBJECT_PEDESTRIAN_3,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(0,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_3).sprite.angle=200,this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().attentionShow(this.getObject(sConstants.OBJECT_PEDESTRIAN_3).sprite.position),this.notification().startNotification(sConstants.N05_04_COLLISION),this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_2).sprite.angle=180}),s.notification().addNotification(sConstants.N05_04_COLLISION,{pl:["Przez nierozwagę dochodzi do","wypadku."],en:[]},1,1,function(){this.notification().startNotification(Situation05.prototype.instructionTexts.good.name)},s);break;case 4:s.stageNumberFromWhichPositionsAreTaken=0,this.initStage(0,s);break;case 5:this.initStage(1,s);break;case 6:s.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN_3,0,-a),s.addStartingVelocity(sConstants.OBJECT_PEDESTRIAN_2,0,-a),s.addCollisionHandler(sConstants.T05_02_PED_TURN_BUS,sConstants.OBJECT_PEDESTRIAN_2,function(){this.getObject(sConstants.OBJECT_BUS).setVelocity(0,o/15,0,50),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,-e/2)}),s.addCollisionHandler(sConstants.T05_02_PED_TURN_BUS,sConstants.OBJECT_PEDESTRIAN_3,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(0,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().startNotification(sConstants.N05_07_PEDESTRIAN_PROPER)}),s.notification().addNotification(sConstants.N05_07_PEDESTRIAN_PROPER,{pl:["Pieszy, chcąc dostać się na drugą","stronę, korzysta z przejścia."],en:[]},1,1,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(0,-a),this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,-a)},s),s.addCollisionHandler(sConstants.T05_07_PED_CONTINUE_PROPER,sConstants.OBJECT_PEDESTRIAN_3,function(){this.addEvent(0,this.setFinished)});break;case 7:s.addStartingNotificationPlay(sConstants.N05_08_FINISH),s.addCollisionHandler(sConstants.T05_08_CAR_STOP,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0)}),s.notification().addNotification(sConstants.N05_08_FINISH,{pl:["Kierowca zwalnia i ustępuje","pierwszeństwa pieszemu."],en:[]},1,1,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(a,0),this.getObject(sConstants.OBJECT_PEDESTRIAN_3).sprite.angle=180,this.getObject(sConstants.OBJECT_PEDESTRIAN_2).setVelocity(0,-a),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,-e/2,0,75),this.getObject(sConstants.OBJECT_BUS).setVelocity(0,o)},s),s.addCollisionHandler(sConstants.T05_08_CAR_CONTINUE,sConstants.OBJECT_PEDESTRIAN_3,function(){this.getObject(sConstants.OBJECT_PEDESTRIAN_3).setVelocity(0,-a),this.getObject(sConstants.OBJECT_PEDESTRIAN_3).sprite.angle=90,this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,-e/10,0,-100),this.addEvent(4,this.setFinished)});break;default:console.log("initStage() unknown stageNumber")}},Situation01.prototype.sector={x:1,y:0},Situation01.prototype.title={pl:["Omijanie na przejściu","dla pieszych."],en:["Pedestrian's","safety."]},Situation01.prototype.collisions=[[sConstants.TRIGGER_S01_PEDESTRIAN,sConstants.OBJECT_PEDESTRIAN],[sConstants.TRIGGER_S01_END,sConstants.OBJECT_PEDESTRIAN],[sConstants.TRIGGER_S02_CARA_BRAKE,sConstants.OBJECT_CAR_A],[sConstants.OBJECT_PEDESTRIAN,sConstants.OBJECT_CAR_A],[sConstants.OBJECT_PEDESTRIAN,sConstants.OBJECT_CAR_B],[sConstants.TRIGGER_S02_CARA_BRAKE,sConstants.OBJECT_CAR_A],[sConstants.TRIGGER_S02_CARA_BRAKE,sConstants.OBJECT_CAR_B],[sConstants.TRIGGER_S02_CARA_STOP,sConstants.OBJECT_CAR_A],[sConstants.OBJECT_CAR_B,sConstants.OBJECT_PEDESTRIAN],[sConstants.TRIGGER_S03_CARB_BRAKE,sConstants.OBJECT_CAR_B],[sConstants.TRIGGER_S07_CARB_BRAKE,sConstants.OBJECT_CAR_B],[sConstants.TRIGGER_S07_CARB_STOP,sConstants.OBJECT_CAR_B],[sConstants.TRIGGER_S07_PEDESTRIAN_CHECK,sConstants.OBJECT_PEDESTRIAN],[sConstants.TRIGGER_S08_PEDESTRIAN_FINISH,sConstants.OBJECT_PEDESTRIAN]],Situation01.prototype.situationPlan=[{type:"roadObject",sprite:"pedestrian01",name:sConstants.OBJECT_PEDESTRIAN,posX:700,posY:135,angle:0},{type:"roadObject",sprite:"car01",name:sConstants.OBJECT_CAR_A,posX:530,posY:550,angle:-90},{type:"roadObject",sprite:"car02",name:sConstants.OBJECT_CAR_B,posX:468,posY:1300,angle:-90},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S01_PEDESTRIAN,posX:610,posY:136,angle:-90},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S01_END,posX:580,posY:136,angle:-90},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S02_CARA_BRAKE,posX:530,posY:420,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S02_CARA_STOP,posX:535,posY:222,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S03_CARB_BRAKE,posX:480,posY:270,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S07_CARB_BRAKE,posX:480,posY:420,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S07_PEDESTRIAN_CHECK,posX:500,posY:136,angle:-90},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S07_CARB_STOP,posX:470,posY:221,angle:0},{type:"roadTrigger",sprite:"trigger",name:sConstants.TRIGGER_S08_PEDESTRIAN_FINISH,posX:350,posY:136,angle:-90}],Situation01.prototype.instructionTexts={bad:{name:"situationIntroducion",text:{pl:["Opis sytuacji.","Opis sytuacji.","Opis sytuacji."],en:[]}},good:{name:"goodIntroduction",text:{pl:["Z braku rozwagi dochodzi do tragedii.","Jak powinna wyglądać prawidłowa","sytuacja?"],en:[]}}},Situation02.prototype.initStage=function(t,i){var s=300,n=300;
switch(this.init01=function(t){i.addStartingVelocity(sConstants.OBJECT_BIKE,0,t),i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,n),i.notification().addNotification(sConstants.N02_02_BIKE_INTRO,{pl:["Tymczasem ściezką rowerową jedzie","rowerzysta. Zbliża","się do przejazdu dla rowerów."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i),i.addCollisionHandler(sConstants.T02_02_CAR_TURN,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_BIKE).setVelocity(0,0),this.getObject(sConstants.OBJECT_BIKE).sprite.animations.play("ride"),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().startNotification(sConstants.N02_02_BIKE_INTRO)})},t){case 0:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,n);var o=i.notification().addNotification(sConstants.N02_01_CAR_TURN,{pl:["Kierowca zbliża się do skrzyżowania","z zamiarem skrętu w prawo."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i);o.addPressMeNotification(),i.addCollisionHandler(sConstants.T02_01_CAR_INTRO,sConstants.OBJECT_CAR_A,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().startNotification(sConstants.N02_01_CAR_TURN)});break;case 1:this.init01(s);break;case 2:i.addStartingNotificationPlay(sConstants.N02_03_CAR_A_CONTIMUE),i.notification().addNotification(sConstants.N02_03_CAR_A_CONTIMUE,{pl:["Kierowca nie zachowując szczególnej","ostrożności, kontynuuje manewr","skrętu w prawo."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_BIKE,0,s),this.addEventStartTurn(0,sConstants.OBJECT_CAR_A,sConstants.OBJECT_ROTATION_P,180,600,function(){this.setFinished()},i)},i);break;case 3:i.addStartingVelocity(sConstants.OBJECT_BIKE,0,s),i.addStartingVelocity(sConstants.OBJECT_CAR_A,-n,0),i.addCollisionHandler(sConstants.OBJECT_CAR_A,sConstants.OBJECT_BIKE,function(){this.getObject(sConstants.OBJECT_BIKE).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.notification().attentionShow(this.getObject(sConstants.OBJECT_BIKE).sprite.position),this.notification().startNotification(sConstants.N02_04_COLLISION)}),i.notification().addNotification(sConstants.N02_04_COLLISION,{pl:["Dochodzi do kolizji."],en:[]},1,1,function(){this.notification().startNotification(Situation02.prototype.instructionTexts.good.name)},i);break;case 4:i.stageNumberFromWhichPositionsAreTaken=0,this.initStage(0,i);break;case 5:this.init01(0);break;case 6:i.addStartingNotificationPlay(sConstants.N02_06_CAR_A_CONTINUE),i.notification().addNotification(sConstants.N02_06_CAR_A_CONTINUE,{pl:["Kierowca, widząc ścieżkę rowerową,","zachowuje ostrożność i wykonuje manewr","skrętu z bezpieczną prędkością."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_BIKE,0,s/2),this.addEventStartTurn(0,sConstants.OBJECT_CAR_A,sConstants.OBJECT_ROTATION_P,180,2e3,function(){this.setFinished()},i)},i);break;case 7:i.addStartingNotificationPlay(sConstants.N02_07_WAIT),i.notification().addNotification(sConstants.N02_07_WAIT,{pl:["Kierowca, jadąc zgodnie","z przepisami, zauważa","rowerzystę i ustepuję mu","pierwszeństwa przejazdu."],en:[]},1,1,function(){this.addEventVelocity(0,sConstants.OBJECT_BIKE,0,s),this.addEventVelocity(1.2,sConstants.OBJECT_CAR_A,-n/8,0,-500,0),this.addEvent(3,this.setFinished)},i);break;default:console.log("initStage() unknown stageNumber")}},Situation04.prototype.initStage=function(t,i){var s=-300,n=-310;switch(t){case 0:i.addStartingNotificationPlay(sConstants.N04_01_INTRO);var o=i.notification().addNotification(sConstants.N04_01_INTRO,{pl:["Dwóch kierowców jedzie w tym","samym kierunku"],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i);o.addPressMeNotification();break;case 1:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,s),i.addStartingVelocity(sConstants.OBJECT_CAR_B,0,n,0,-50),i.addCollisionHandler(sConstants.T04_02_OVERTAKE_INTRO,sConstants.OBJECT_CAR_B,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_B).setVelocity(0,0),this.notification().startNotification(sConstants.N04_02_OVERTAKE_INTRO)}),i.notification().addNotification(sConstants.N04_02_OVERTAKE_INTRO,{pl:["Jeden z nich wykonuje manewr","wyprzedzania."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i);break;case 2:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,s),i.addStartingVelocity(sConstants.OBJECT_CAR_B,0,n,0,-50),i.addCollisionHandler(sConstants.T04_03_OVERTAKE_PEDESTRIAN,sConstants.OBJECT_CAR_B,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_B).setVelocity(0,0),this.notification().startNotification(sConstants.N04_03_OVERTAKE_PEDESTRIAN)}),i.notification().addNotification(sConstants.N04_03_OVERTAKE_PEDESTRIAN,{pl:["Manewr zostaje dokonany bezpośrednio","przed przejściem dla pieszych,","względnie na przejściu dla pieszych."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i);break;case 3:i.addStartingNotificationPlay(sConstants.N04_04_ILLEGAL),i.notification().addNotification(sConstants.N04_04_ILLEGAL,{pl:["Wyprzedzanie na przejściu","lub przed przejściem","dla pieszych jest niedozowolne."],en:[]},1,1,function(){i.addEventVelocity(0,sConstants.OBJECT_CAR_A,0,s),i.addEventVelocity(0,sConstants.OBJECT_CAR_B,0,n,0,-50)},i),i.addCollisionHandler(sConstants.T04_04_BAD_END,sConstants.OBJECT_CAR_B,function(){this.notification().startNotification(Situation04.prototype.instructionTexts.good.name)});break;case 4:i.stageNumberFromWhichPositionsAreTaken=0,this.initStage(0,i);break;case 5:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,s),i.addStartingVelocity(sConstants.OBJECT_CAR_B,0,n,0,0),i.addCollisionHandler(sConstants.T04_02_OVERTAKE_INTRO,sConstants.OBJECT_CAR_B,function(){this.getObject(sConstants.OBJECT_CAR_A).setVelocity(0,0),this.getObject(sConstants.OBJECT_CAR_B).setVelocity(0,0),this.notification().startNotification(sConstants.N04_05_OVERTAKE_INTRODUCTION)}),i.notification().addNotification(sConstants.N04_05_OVERTAKE_INTRODUCTION,{pl:["Jeden z nich chce wykonać manewr","wyprzedzania, jednak wstrzymuje","się z nim, widząc przejście dla pieszych."],en:[]},1,1,function(){this.addEvent(0,this.setFinished)},i);break;case 6:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,s),i.addStartingVelocity(sConstants.OBJECT_CAR_B,0,n+40,0),i.addCollisionHandler(sConstants.T04_03_OVERTAKE_PEDESTRIAN,sConstants.OBJECT_CAR_B,function(){this.addEvent(0,this.setFinished)});break;case 7:i.addStartingVelocity(sConstants.OBJECT_CAR_A,0,s),i.addStartingVelocity(sConstants.OBJECT_CAR_B,0,n+25,0,50),i.addCollisionHandler(sConstants.T04_04_BAD_END,sConstants.OBJECT_CAR_B,function(){this.addEvent(1.5,this.setFinished)});break;default:console.log("initStage() unknown stageNumber")}},SituationsManager.prototype.initNotificationsFactoryManager=function(){this.notificationsFactoryManager=new NotificationsFactoryManager(this.game,this.fx)},SituationsManager.prototype.initSituations=function(){var t=[new Situation01,new Situation02,new Situation03,new Situation04,new Situation05],i=this.game.add.sprite(440,350,"presenter");i.scale.setTo(.4,.4),sConstants.PRESENTER_VISIBLE||(i.visible=!1);for(var s=0,n=0;n<t.length;n++){var o=t[n],a=new Situation(this.game,this.roadObjectsFactory,this.notificationsFactoryManager,this,o,i,this.fx);this.pushNewSituation(a);var e=160;n%2===1&&(e=480);var r=40+100*n;r=120*this.game.math.roundTo((n+1)/2,0);var c=this.notificationsFactory.addNotification(n,o.title,e,r,this.startSituation,this,n).width;c>s&&(s=c),this.roadObjectsFactory.reset()}sConstants.DEBUG||this.startIntroNotification(),sConstants.DEBUG&&this.game.time.events.add(300,this.startSituation,this,sConstants.DEBUG_SITUATION)},SituationsManager.prototype.getCurrentSituation=function(){return this.situations[this.situationsPointer]},this.SituationsManager.prototype.startIntroNotification=function(){this.introNotificationsFactory.addNotification("introNotif",{pl:["Aby kontynować działanie, należy klikać","pomarańczowe przyciski."],en:["To continue, just","click orange buttons."]},-1,-1,this.startMenu,this);this.introNotificationsFactory.setNotification("introNotif",!0)},SituationsManager.prototype.startMenu=function(){this.roadObjectsFactory.reset(),this.backgroundManipulator.resetZoom(),this.notificationsFactory.startAllNotifications(0,!0),this.buttonMenu.visible=!1},SituationsManager.prototype.backToMenu=function(){-1!==this.situationsPointer&&(this.getCurrentSituation().setFinished(),this.situationsPointer=-1),this.startMenu()},SituationsManager.prototype.startSituation=function(t){for(key in this.notificationsFactory.notifications)key!==t&&this.notificationsFactory.setNotification(key,!1);var i=this.situations[t],s=i.getSector();this.backgroundManipulator.zoomToSector(s.x,s.y),sConstants.DEBUG?i.startSituation():sConstants.SITUATION_START_WITH_INTRODUCTION?i.notificationsFactory.startNotification(i.concreteSituation.instructionTexts.bad.name,0):i.startSituation(),this.situationsPointer=t,this.buttonMenu.visible=!0},SituationsManager.prototype.pushNewSituation=function(t){this.situations.push(t)},SituationsManager.prototype.update=function(){-1!==this.situationsPointer&&this.getCurrentSituation().isInProgress()&&this.getCurrentSituation().update(this.game)},SituationsManager.prototype.onCurrentSituationFinished=function(){this.startMenu()},SituationStage.prototype.addEventVelocity=function(t,i,s,n,o,a){this.addEvent(t,this.setVelocity,i,s,n,o,a)},SituationStage.prototype.addEventStartTurn=function(t,i,s,n,o,a,e){this.addEvent(t,this.startObjectTurn,i,s,n,o,a,e)},SituationStage.prototype.addEvent=function(t,i){callArgs=Array.prototype.splice.call(arguments,2),callArgs.splice(0,0,i),this.game.time.events.add(Phaser.Timer.SECOND*t,this.fireEvent,this,callArgs)},SituationStage.prototype.fireEvent=function(t){args=Array.prototype.splice.call(arguments[0],1),fun=t[0],fun.apply(this,args)},SituationStage.prototype.setVelocity=function(t,i,s,n,o){this.getObject(t).setVelocity(i,s,n,o)},SituationStage.prototype.startObjectTurn=function(t,i,s,n,o,a){this.getObject(t).startObjectTurn(i,s,n,o,a)},SituationStage.prototype.addStartingPosition=function(t,i,s,n){this.startingPositions[t]={x:i,y:s,angle:n}},SituationStage.prototype.addStartingPositionsFromStage=function(t){var i=this.manager.getStage(t);for(var s in i.startingPositions)this.startingPositions[s]={x:i.startingPositions[s].x,y:i.startingPositions[s].y,angle:angle}},SituationStage.prototype.addStartingVelocity=function(t,s,n,o,a){var e,r=1;for("object"==typeof t&&(r=t.length,e=t),i=0;i<r;i++){r>1&&(t=e[i]);var c=o,_=a;void 0===o&&(c=0),void 0===a&&(_=0),this.startingVelocities[t]={x:s,y:n,accelX:c,accelY:_}}},SituationStage.prototype.addStartingVelocityTurn=function(){},SituationStage.prototype.addStartingAnimation=function(t,i){this.startingAnimations[t]=i},SituationStage.prototype.addStartingNotificationPlay=function(t,i,s){this.startingNotificationsToPlay[t]={delay:i,duration:s}},SituationStage.prototype.addCollisionHandler=function(t,i,s){void 0===this.collisionHandlers[t]&&(this.collisionHandlers[t]={}),this.collisionHandlers[t][i]=s},SituationStage.prototype.start=function(){this.rememberStartingPositionsOnce();for(var t in this.startingPositions){var i=this.roadObjectsFactory.roadObjects[t];i.sprite.body.moves=!1;var s=this.startingPositions[t].x,n=this.startingPositions[t].y,o=this.startingPositions[t].angle;i.sprite.x=s,i.sprite.y=n,i.sprite.angle=o,(-90===o||90==o)&&i.sprite.body.setSize(i.sprite.height,i.sprite.width),void 0!==this.startingAnimations[t]&&i.sprite.animations.play(this.startingAnimations[t])}this.spritesBodyMovementUnlockNeeded=!0;for(var a in this.startingNotificationsToPlay){var e=this.startingNotificationsToPlay[a];this.notificationsFactory.startNotification(a,e.delay,e.duration)}},SituationStage.prototype.rememberStartingPositionsOnce=function(){if(!this.startingPositionsInitialized)if(this.startingPositionsInitialized=!0,-1===this.stageNumberFromWhichPositionsAreTaken)for(var t in this.roadObjectsFactory.roadObjects)void 0===this.startingPositions[t]&&(this.startingPositions[t]={x:this.roadObjectsFactory.roadObjects[t].sprite.x,y:this.roadObjectsFactory.roadObjects[t].sprite.y,angle:this.roadObjectsFactory.roadObjects[t].sprite.angle});else{var i=this.manager.getStage(this.stageNumberFromWhichPositionsAreTaken);for(var s in i.startingPositions)this.startingPositions[s]={x:i.startingPositions[s].x,y:i.startingPositions[s].y,angle:i.startingPositions[s].angle}}},SituationStage.prototype.afterMovementChange=function(){if(this.spritesBodyMovementUnlockNeeded){this.spritesBodyMovementUnlockNeeded=!1;for(var t in this.roadObjectsFactory.roadObjects){var i=this.roadObjectsFactory.roadObjects[t];if(i.sprite.body.reset(i.sprite.x,i.sprite.y),void 0!==this.startingVelocities[t]){var s=this.startingVelocities[t],n=i.sprite.body;n.velocity.x=s.x,n.velocity.y=s.y,n.acceleration.x=s.accelX,n.acceleration.y=s.accelY}i.sprite.body.moves=!0}}},SituationStage.prototype.getObject=function(t){return this.roadObjectsFactory.roadObjects[t]},SituationStage.prototype.notification=function(){return this.notificationsFactory},SituationStage.prototype.setFinished=function(){this.notification().attentionHide(),this.manager.onStageFinished(this.number)},SituationStage.prototype.handleCollision=function(t,i){void 0!==this.collisionHandlers[t.name]&&void 0!==this.collisionHandlers[t.name][i.name]&&this.collisionHandlers[t.name][i.name].call(this)},SituationStage.prototype.onStageButtonClick=function(){this.manager.currentStageNumber=this.number,this.manager.situation.startStage(this.number)},Situation.prototype.initSituationObjects=function(){for(var t=0;t<this.concreteSituation.situationPlan.length;t++){var i,s=this.concreteSituation.situationPlan[t].name,n=this.concreteSituation.situationPlan[t].type,o=this.concreteSituation.situationPlan[t].sprite,a=this.concreteSituation.situationPlan[t].posX,e=this.concreteSituation.situationPlan[t].posY,r=this.concreteSituation.situationPlan[t].angle;i=this.roadObjectsFactory.objectExists(s)?this.roadObjectsFactory.get(s):this.roadObjectsFactory.create(s,o),i.setPos(a,e),i.sprite.angle=r,(-90===r||90==r)&&i.sprite.body.setSize(i.sprite.height,i.sprite.width),"roadTrigger"===n&&(i.sprite.alpha=0)}},Situation.prototype.getSector=function(){return this.concreteSituation.sector},Situation.prototype.initIntroduction=function(){this.notificationsFactory.addNotification(this.concreteSituation.instructionTexts.bad.name,this.concreteSituation.instructionTexts.bad.text,-1,-1,this.startSituation,this),this.notificationsFactory.addNotification(this.concreteSituation.instructionTexts.good.name,this.concreteSituation.instructionTexts.good.text,-1,-1,SituationStage.prototype.setFinished,this.situationStagesManager.getStage(3))},Situation.prototype.isInProgress=function(){return this.situationInProgress},Situation.prototype.initStages=function(){this.initStage(0,!0),this.initStage(1,!0),this.initStage(2,!0),this.initStage(3,!0),this.initStage(4,!1),this.initStage(5,!1),this.initStage(6,!1),this.initStage(7,!1)},Situation.prototype.initStage=function(t,i){var s=new SituationStage(this.situationStagesManager,this.game,this.roadObjectsFactory);0===t&&s.rememberStartingPositionsOnce(),this.concreteSituation.initStage(t,s),this.situationStagesManager.pushNewStage(s,i)},Situation.prototype.startSituation=function(){this.situationInProgress=!0,this.setObjectsTextPositions(),this.startStage(0)},Situation.prototype.setObjectsTextPositions=function(){for(key in this.roadObjectsFactory.roadObjects){var t=this.roadObjectsFactory.get(key);t.setTextPos(-999,999)}for(var i=0;i<this.concreteSituation.situationPlan.length;i++){var s=this.concreteSituation.situationPlan[i].name,n=this.roadObjectsFactory.get(s);n.setTextPos(10,20*i)}},Situation.prototype.startStage=function(t){this.resetCollisionCheck();this.situationStagesManager.getStage(t);this.situationStagesManager.getStage(t).start()},Situation.prototype.update=function(t){this.situationStagesManager.getCurrentStage().afterMovementChange(),this.handleCollisions(t)},Situation.prototype.onSituationFinished=function(){this.situationInProgress=!1,this.manager.onCurrentSituationFinished()},Situation.prototype.setFinished=function(){this.notificationsFactory.setNotificationsAll(!1),this.situationStagesManager.getStageLast().setFinished()},Situation.prototype.handleCollisions=function(t){for(var i=0;i<this.concreteSituation.collisions.length;i++){var s=this.concreteSituation.collisions[i],n=this.roadObjectsFactory.get(s[0]).sprite,o=this.roadObjectsFactory.get(s[1]).sprite;this.isCollisionChecked(n,o)||t.physics.arcade.overlap(n,o,this.collisionHandler,null,this)}},Situation.prototype.collisionHandler=function(t,i){this.addCheckedCollision(t,i),this.situationStagesManager.getCurrentStage().handleCollision(t,i)},Situation.prototype.addCheckedCollision=function(t,i){void 0===this.checkedCollisions[t.name]&&(this.checkedCollisions[t.name]=new Object),this.checkedCollisions[t.name][i.name]=!0},Situation.prototype.isCollisionChecked=function(t,i){return void 0===this.checkedCollisions[t.name]?!1:void 0===this.checkedCollisions[t.name][i.name]?!1:this.checkedCollisions[t.name][i.name]},Situation.prototype.resetCollisionCheck=function(){for(var t in this.checkedCollisions)for(var i in this.checkedCollisions[t])this.checkedCollisions[t][i]=!1},SituationStagesManager.prototype.getSituation=function(){return this.situation},SituationStagesManager.prototype.pushNewStage=function(t,i){t.number=this.stages.length,this.stages.push(t);var s,n={};s=i?40*this.stages.length+200:40*(this.stages.length-4)+200;var o=440,a=0,e=1;i||(a+=2,e+=2);var r=this.game.add.button(s,o,"stageButtons",t.onStageButtonClick,t,a,e);r.scale.x=.5,r.scale.y=.5,r.visible=!1;var c;c=i?t.number+1:t.number-3;var _=this.game.add.text(s+10,o+8,c,{font:"20px Arial",fill:"#FFF"});_.visible=!1,n.button=r,n.text=_,i?this.stagesButtonsBad.push(n):this.stagesButtonsGood.push(n)},SituationStagesManager.prototype.getStage=function(t){return this.stages[t]},SituationStagesManager.prototype.getStageLast=function(){return this.stages[this.stages.length-1]},SituationStagesManager.prototype.getCurrentStage=function(){return this.stages[this.currentStageNumber]},SituationStagesManager.prototype.setStageButtons=function(t,i){return},SituationStagesManager.prototype.onStageFinished=function(t){t!==this.stages.length-1?(this.currentStageNumber++,this.situation.startStage(this.currentStageNumber)):(this.currentStageNumber=0,this.situation.onSituationFinished())},RoadObjectFactory=function(t){this.roadObjects=new Object,this.roadObjectsGroup=t.add.group(),this.game=t,this.testSingleFunctionInvoked=!0,this.testSingleFunction={},this.testSingleFunctionRoadObject={}},RoadObjectFactory.prototype.create=function(t,i){var s=this.roadObjectsGroup.create(0,0,i);"jimmy"===i?(s.animations.add("left",[0,1],10,!0),s.animations.add("front",[2],10,!0)):"bike"===i&&(s.animations.add("ride",[0,0],0,!0),s.animations.add("walk",[1,1],0,!0)),"ball"!==i||sConstants.DEBUG||(s.visible=!1);var n=new RoadObject(this,t,s,this.game);return this.roadObjects[t]=n,n},RoadObjectFactory.prototype.reset=function(){this.callAll(RoadObject.prototype.reset)},RoadObjectFactory.prototype.objectExists=function(t){return void 0!==this.roadObjects[t]},RoadObjectFactory.prototype.get=function(t){return this.roadObjects[t]},RoadObjectFactory.prototype.callAll=function(t){Object.keys(this.roadObjects).length;for(var i in this.roadObjects)t.call(this.get(i))},SafeDrive={},RoadObject=function(t,i,s,n){return this.factory=t,this.name=i,this.game=n,this.sprite=s,this.sprite.name=i,this.sprite.anchor.setTo(.5,.5),n.physics.arcade.enable(this.sprite,Phaser.Physics.ARCADE),this.sprite.body.immovable=!0,sConstants.DEBUG&&(this.sprite.inputEnabled=!0,this.sprite.input.enableDrag(),this.sprite.events.onDragStart.add(function(t){t.body.moves=!1},this,this),this.sprite.events.onDragStop.add(function(t){t.body.reset(t.x,t.y),t.body.moves=!0},this,this)),this.text=n.add.text(0,0,"",{font:"20px Arial",fill:"#de1f1f"}),sConstants.DEBUG||(this.text.visible=!1),this},RoadObject.prototype.reset=function(){var t=9999;this.sprite.x=t,this.sprite.y=t;var i=this.sprite.body;i.moves=!1,i.velocity.x=0,i.velocity.y=0,i.acceleration.x=0,i.acceleration.y=0},RoadObject.prototype.setPos=function(t,i){this.sprite.x=t,this.sprite.y=i},RoadObject.prototype.setTextPos=function(t,i){this.text.x=t,this.text.y=i},RoadObject.prototype.setVelocity=function(t,i,s,n){var o=s,a=n;void 0===s&&(o=0),void 0===n&&(a=0),this.sprite.body.velocity.x=t,this.sprite.body.velocity.y=i,this.sprite.body.acceleration.x=o,this.sprite.body.acceleration.y=a},RoadObject.prototype.updateText=function(){this.text.text=this.name+" ["+this.sprite.x+", "+this.sprite.y+"]"},RoadObject.prototype.startObjectTurn=function(t,i,s,n,o){this.rotationAngle={angle:0},this.rotationMem=0;var a=this.factory.get(t);this.pivotX=a.sprite.x,this.pivotY=a.sprite.y,this.game.add.tween(this.sprite).to({angle:i},s,Phaser.Easing.Linear.In,!0,0,0);var e=this.game.add.tween(this.rotationAngle).to({angle:90},s,Phaser.Easing.Linear.In,!0,0,0);e.onUpdateCallback(function(){this.diff=this.rotationAngle.angle-this.rotationMem,this.rotationMem=this.rotationAngle.angle,this.sprite.position.rotate(this.pivotX,this.pivotY,this.game.math.wrapAngle(this.diff),!0)},this),e.onComplete.add(function(){this.sprite.body.setSize(this.sprite.width,this.sprite.height)},this),e.onComplete.add(n,o)},Notification.prototype.initEmptyLanguages=function(){0===this.languageTextArrays.en.length&&(this.languageTextArrays.en.push("I'm not translated"),this.languageTextArrays.en.push("yet."))},Notification.prototype.initButton=function(){this.growSpeed=200,this.button={buttonPhaser:this.game.add.button(0,0,"button",this.buttonClicked,this,1,0,2,0),frameUp:this.game.add.sprite(0,0,"button_border_normal"),frameDown:this.game.add.sprite(0,0,"button_border_pressed"),callback:this.callback,callbackContext:this.callbackContext,args:this.callArgs},this.button.buttonPhaser.setSounds(this.fx,"click3",this.fx,"click1"),this.button.buttonPhaser.anchor.setTo(.5,.5),this.button.frameUp.anchor.setTo(.5,.5),this.button.frameDown.anchor.setTo(.5,.5),this.button.buttonPhaser.visible=!1,this.button.frameUp.visible=!1,this.button.frameUp.height=3,this.button.frameDown.visible=!1,this.button.frameDown.height=3,this.button.buttonPhaser.onInputDown.add(function(){this.button.frameUp.visible=!1,this.button.frameDown.visible=!0},this)},Notification.prototype.initTextObjects=function(t,i){t.forEach(function(t){var s=this.game.add.text(-999,-999,t,{font:"25px Arial",fill:"#FFFFFF"});s.anchor.setTo(0,0),s.visible=!1,i.push(s)},this)},Notification.prototype.buttonClicked=function(){this.factory.setNotification(this.id,!1),this.button.callback.apply(this.button.callbackContext,this.button.args)},Notification.prototype.update=function(t,i){var s,n;if(i===constantsLanguages.PL)s=this.languageTextArrays.pl,n=this.languageTextObjects.pl;else{if(i!==constantsLanguages.EN)return void console.log("Notification.prototype.update(): unknown language ("+i+")");s=this.languageTextArrays.en,n=this.languageTextObjects.en}this.updateSpritesParameters(s,i),this.button.buttonPhaser.position.setTo(this.notificationX,this.notificationY),this.button.frameUp.position.setTo(this.notificationX,this.notificationY+this.height/2),this.button.frameDown.position.setTo(this.notificationX,this.notificationY-this.height/2);for(key in this.languageTextObjects){var o=this.languageTextObjects[key];o.forEach(function(t){t.visible=!1})}var a=this.notificationY-this.height/2+this.margins;n.forEach(function(i){i.visible=t,i.x=this.notificationX-this.width/2+this.margins,i.y=a,a+=30},this);var e=this.pressMeNotification;if(void 0!==e){e.sprite.visible=t,e.textObject.visible=t;var r=this.notificationX-this.width/2-10,c=this.notificationY-this.height/2-10;e.sprite.position.setTo(r,c),e.textObject.text=i==constantsLanguages.PL?e.text.pl:e.text.en,e.textObject.position.setTo(r,c)}},Notification.prototype.updateSpritesParameters=function(t,i){if(this.width=void 0!==this.widthSetManually?this.widthSetManually:this.getWidth(i),this.height=32*t.length+20,void 0===this.requestedX)this.notificationX=this.presenterSprite.x,this.notificationY=this.presenterSprite.y;else if(-1===this.requestedX&&-1===this.requestedY)this.notificationX=320,this.notificationY=240;else if(1===this.requestedX&&1===this.requestedY){var s=20;this.notificationX=640-this.width/2-s,this.notificationY=480-this.height/2-s}else this.notificationX=this.requestedX,this.notificationY=this.requestedY},Notification.prototype.addGrowTween=function(t,i){var s=this.game.add.tween(t).to(i,this.growSpeed,this.tweenFunction,!0);return s},Notification.prototype.buttonGrow=function(){this.button.buttonPhaser.alpha=1,this.button.buttonPhaser.visible=!0,this.button.frameDown.visible=!1,this.button.frameUp.visible=!0;var t=this.addGrowTween(this.button.buttonPhaser,{width:this.width});return this.addGrowTween(this.button.frameUp,{width:this.width}),this.addGrowTween(this.button.frameDown,{width:this.width}),this.addGrowTween(this.button.buttonPhaser,{height:this.height}),t},Notification.prototype.buttonShrink=function(){this.button.frameDown.visible=!1,this.button.frameUp.visible=!1;var t=this.addGrowTween(this.button.buttonPhaser,{width:1});return t.onComplete.add(function(){this.visible=!1,this.alpha=0},this.button.buttonPhaser),this.addGrowTween(this.button.frameUp,{width:1}),this.addGrowTween(this.button.frameDown,{width:1}),this.addGrowTween(this.button.buttonPhaser,{height:1}),t},Notification.prototype.getWidth=function(t){var i;t===constantsLanguages.PL?(i=this.languageTextArrays.pl,textObjects=this.languageTextObjects.pl):t===constantsLanguages.EN&&(i=this.languageTextArrays.en,textObjects=this.languageTextObjects.en);var s=0;return i.forEach(function(t){t.length>s&&(s=t.length)}),13*s+this.margins},Notification.prototype.setWidth=function(t){this.widthSetManually=t},Notification.prototype.isVisible=function(){return this.button.buttonPhaser.visible},Notification.prototype.addPressMeNotification=function(){this.pressMeNotification={sprite:this.game.add.sprite(-999,-999,"blank_red"),text:{pl:"Wciśnij mnie.",en:"Press me."},textObject:this.game.add.text(-999,-999,"",{font:"20px Arial",fill:"#FFFFFF"})},this.pressMeNotification.sprite.anchor.setTo(.5,.5),this.pressMeNotification.textObject.anchor.setTo(.5,.5);var t=160,i=40,s=2.5*this.growSpeed;this.pressMeNotification.sprite.width=t,this.pressMeNotification.sprite.height=i,this.game.add.tween(this.pressMeNotification.sprite).to({width:.8*t},s,this.tweenFunction,!0,0,-1,!0),this.game.add.tween(this.pressMeNotification.sprite).to({height:.8*i},s,this.tweenFunction,!0,0,-1,!0)},NotificationsFactory.prototype.addNotification=function(t,i,s,n,o,a){var e=Array.prototype.splice.call(arguments,6);return this.notifications[t]=new Notification(this,this.game,t,i,this.presenterSprite,s,n,this.fx,o,a,e),this.notifications[t]},NotificationsFactory.prototype.setNotification=function(t,i){var s=this.getNotification(t);s.update(i,this.language);var n;return n=1==i?s.buttonGrow():s.buttonShrink()},NotificationsFactory.prototype.setNotificationsAll=function(t){for(key in this.notifications)this.setNotification(key,t)},NotificationsFactory.prototype.startNotification=function(t,i,s){var n=i;void 0===i&&(n=0),this.game.time.events.add(Phaser.Timer.SECOND*n,function(){this.setNotification(t,!0),void 0!==s&&this.game.time.events.add(Phaser.Timer.SECOND*s,function(){this.setNotification(t,!1)},this)},this)},NotificationsFactory.prototype.startAllNotifications=function(t){this.alignWidths();for(key in this.notifications)this.startNotification(key,t)},NotificationsFactory.prototype.alignWidths=function(){if(this.sameWidth===!0){var t=0;for(key in this.notifications){var i=this.getNotification(key);i.getWidth(this.language)>t&&(t=i.getWidth(this.language))}for(key in this.notifications){var i=this.getNotification(key);i.setWidth(t)}}},NotificationsFactory.prototype.getNotification=function(t){return this.notifications[t]},NotificationsFactory.prototype.initAttentionManager=function(){this.attentionManager=new AttentionManager(this.game)},NotificationsFactory.prototype.attentionShow=function(t){this.attentionManager.show(t)},NotificationsFactory.prototype.attentionHide=function(){this.attentionManager.hide()},NotificationsFactory.prototype.onLanguageChange=function(t){this.language=t,this.alignWidths();for(notifKey in this.notifications){var i=this.notifications[notifKey];i.isVisible()?this.setNotification(notifKey,!0):i.update(!1,this.language)}},AttentionManager.prototype.show=function(t){this.sprite.position=t,this.sprite.visible=!0},AttentionManager.prototype.hide=function(){this.sprite.visible=!1},NotificationsFactoryManager.prototype.createFactory=function(t,i,s){var n=new NotificationsFactory(this.game,t,i,this.fx,s);return this.factories.push(n),n},NotificationsFactoryManager.prototype.onLanguageChange=function(t){this.factories.forEach(function(i){i.onLanguageChange(t)})},LanguagesManager.prototype.buttonClickedPL=function(){this.notificationsFactoryManager.onLanguageChange(constantsLanguages.PL)},LanguagesManager.prototype.buttonClickedEN=function(){this.notificationsFactoryManager.onLanguageChange(constantsLanguages.EN)},BackgroundManipulator=function(t){this.game=t,this.background=this.game.add.sprite(0,0,"scenebig"),this.sectorsNumber=3,this.sectorW=this.background.width/this.sectorsNumber,this.sectorH=this.background.height/this.sectorsNumber,this.zoomFunction=Phaser.Easing.Cubic.Out,this.zoomSpeed=2e3,this.resetBackground()},BackgroundManipulator.prototype.resetBackground=function(){var t=this.background;t.x=0,t.y=0,t.width=this.sectorW,t.height=this.sectorH},BackgroundManipulator.prototype.addZoomTween=function(t){this.game.add.tween(this.background).to(t,this.zoomSpeed,this.zoomFunction,!0)},BackgroundManipulator.prototype.zoomToSector=function(t,i){this.addZoomTween({width:this.sectorW*this.sectorsNumber}),this.addZoomTween({height:this.sectorH*this.sectorsNumber}),this.addZoomTween({x:-this.sectorW*t}),this.addZoomTween({y:-this.sectorH*i})},BackgroundManipulator.prototype.resetZoom=function(){this.addZoomTween({width:this.sectorW}),this.addZoomTween({height:this.sectorH}),this.addZoomTween({x:0}),this.addZoomTween({y:0})};
